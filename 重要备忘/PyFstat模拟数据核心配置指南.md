### PyFstat 模拟数据：核心配置指南

本文档为使用 `pyfstat.Writer` 类生成模拟数据提供了一份极简介绍和标准配置建议。

---

### 1. SFT (短时傅里叶变换)

*   **极简介绍**: SFT是引力波数据分析的**基本数据单元**。它是由很长的原始探测器数据切分成的、标准时长（如30分钟）的“数据快照”。使用SFT可以高效地处理多普勒效应和海量数据。

*   **标准配置方法**: 在PyFstat的示例中，我们不使用外部数据，而是通过 `pyfstat.Writer` 类在本地**动态生成**SFT文件。

*   **参数建议**:
    *   `duration` (总观测时长):
        *   **标准搜索**: `100 * 86400` (100天)。能有效积累信噪比。
        *   **快速测试**: `10 * 86400` (10天)。计算量小，但需要配合更强的信号（见后文）。
    *   `Tsft` (单个SFT时长):
        *   **强烈建议**: `1800` (30分钟)。这是业界标准，在避免多普勒涂抹（`Tsft`过长导致）和控制文件数量（`Tsft`过短导致）之间取得了最佳平衡。

---

### 2. 噪声配置 (Noise Configuration)

*   **极简介绍**: 噪声是我们要搜索的信号所处的背景。`pyfstat.Writer` 生成的是理想化的**高斯白噪声**。

*   **标准配置方法**: 主要通过 `sqrtSX` 和 `detectors` 参数进行配置。

*   **参数建议**:
    *   `sqrtSX` (噪声功率谱密度的平方根):
        *   **最关键的参数**，直接决定了背景噪声有多“吵”。
        *   **推荐做法**: 参考 **LIGO 开放科学中心 (LOSC)** 发布的真实数据ASD图，根据您想模拟的观测时期（如O3）和频段，选取一个真实值。
        *   **典型值**: 模拟O3运行可使用 `~4e-23`；模拟未来A+探测器可使用 `~1e-23`。
    *   `detectors` (探测器):
        *   **推荐**: `'H1,L1'`。使用多个探测器进行联合分析是提高探测能力和置信度的关键。

*   **多探测器联合分析要点**:
    *   **优势**:
        *   **提升信噪比**: `SNR` 提升约 `sqrt(N)` 倍 (N为探测器数量)，显著增强探测能力。
        *   **降低虚警率**: 噪声背景更稳定 (遵循 χ²(4N) 分布)，极端噪声尖峰数量显著减少。
    *   **代价**:
        *   **计算量增加**: 计算耗时与探测器数量 `N` 大致成正比。

---

### 3. 信号注入 (Signal Injection)

*   **极简介绍**: 为了测试搜索算法是否有效，我们在生成的噪声中人为地加入一个参数已知的、微弱的模拟信号。

*   **标准配置方法**: 将一个包含所有信号物理参数的字典传递给 `pyfstat.Writer`。

*   **参数建议**:

| 参数 | 系统允许范围 | 推荐范围与原因 |
| :--- | :--- | :--- |
| `h0` | > 0 | **强烈建议**: 通过 `depth` 参数间接定义，而非手动指定。`h0 = float(sqrtSX) / depth`。对于标准搜索，`depth` 可取`~70`；对于快速测试，可取`~20`。 |
| `F0` | > 0 (Hz) | **10 Hz 到 2000 Hz**。这是LIGO/Virgo等地面探测器最灵敏的频段。示例中常用`30`Hz, `100`Hz等。 |
| `F1` | 无限制 (Hz/s) | **几乎总是负值**，代表孤立中子星因辐射而减速。典型值在 **-1e-9 到 -1e-15** 之间。`0`常用于最简单的模型测试。 |
| `F2` | 无限制 (Hz/s²) | 高阶参数，效应微小且计算成本高。在绝大多数探索性搜索中，**建议设为0或不配置**。 |
| `Alpha`| `[0, 2π]` (rad) | **全范围**。代表天球坐标赤经。可设任意值，或在全天搜索中作为扫描维度。 |
| `Delta`| `[-π/2, +π/2]` (rad) | **全范围**。代表天球坐标赤纬。 |
| `cosi` | `[-1, 1]` | **全范围**。`1`或`-1`代表信号最强的“极视”(pole-on)情况；`0`代表信号较弱、更难探测的“赤道视”(equator-on)情况，是更具挑战性的测试。 |

---

### 4. 数据生成与使用流程

*   **生成耗时**
    *   **简要原理**: 生成SFT数据所需时间主要与 `duration` (总时长) 和探测器数量成正比。对于典型配置，该过程通常很快（秒级到分钟级），远小于后续的搜索耗时。

*   **保存与读取机制**
    *   **简要原理**: `pyfstat.Writer` 对象负责生成SFT文件并将其保存在磁盘上，然后提供一个文件路径匹配模式。`pyfstat.Search` 对象则使用这个模式来自动寻找并加载这些文件。
    *   **使用方法**: 这是连接“生成”和“搜索”两个步骤的关键，流程非常简单：

    ```python
    # --- 第1步：生成与保存 ---
    data_writer = pyfstat.Writer(label="MyTest", ...)
    data_writer.make_data()
    # data_writer.sftfilepath 属性现已包含一个路径模式，如 'data/MyTest-*.sft'

    # --- 第2步：读取与搜索 ---
    search = pyfstat.GridSearch(
        sftfilepattern=data_writer.sftfilepath, # <-- 无缝衔接
        ...
    )
    search.run()
    ```

---

### 5. 核心算法 (Kernel)

*   **简要原理**: PyFstat本身是一个Python封装，它将繁重、复杂的计算任务交由其底层的LALSuite C代码库来执行。这个C代码库就是实际的算法核心（Kernel）。

*   **核心引擎**: 对于我们讨论的标准搜索，其核心引擎可以认为是**`lalapps_ComputeFstatistic_v2`**程序背后的计算函数库。它负责执行单点的全相干F统计量计算。

*   **功能抽象**: 从使用者角度，`GridSearch`所循环调用的核心功能，可以被精确地理解为一个“黑盒子”函数：它接收一组信号参数，返回一个F统计量值。

    `f(params) -> 2F_value`
